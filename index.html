<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VacExternal - Free Key (4h)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: #ffffff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            max-width: 650px;
            width: 100%;
            background: rgba(20, 20, 30, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 2px solid rgba(255, 140, 0, 0.3);
        }
        .logo {
            text-align: center;
            margin-bottom: 30px;
        }
        .logo h1 {
            font-size: 42px;
            background: linear-gradient(135deg, #ff8c00, #ff4500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .logo p {
            color: #888;
            font-size: 16px;
        }
        .info-box {
            background: rgba(255, 140, 0, 0.1);
            border-left: 4px solid #ff8c00;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .info-box h3 {
            color: #ff8c00;
            margin-bottom: 15px;
            font-size: 20px;
        }
        .info-box ul {
            list-style: none;
            padding-left: 0;
        }
        .info-box ul li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
            font-size: 15px;
        }
        .info-box ul li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #ff8c00;
            font-weight: bold;
            font-size: 18px;
        }
        .captcha-wrapper {
            background: rgba(255, 140, 0, 0.08);
            border: 1px solid rgba(255, 140, 0, 0.3);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 25px;
        }
        .captcha-title {
            text-align: center;
            color: #ffb347;
            font-weight: 600;
            margin-bottom: 12px;
        }
        .captcha-box {
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .captcha-helper {
            text-align: center;
            font-size: 13px;
            color: #cfcfcf;
            margin-top: 12px;
        }
        .btn {
            width: 100%;
            padding: 18px;
            font-size: 20px;
            font-weight: bold;
            background: linear-gradient(135deg, #ff8c00, #ff4500);
            color: #ffffff;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(255, 140, 0, 0.5);
        }
        .btn:active {
            transform: translateY(0);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
        }
        .btn-secondary {
            background: linear-gradient(135deg, #4a90e2, #357abd);
        }
        .btn-secondary:hover {
            box-shadow: 0 15px 40px rgba(74, 144, 226, 0.5);
        }
        .step {
            display: none;
        }
        .step.active {
            display: block;
        }
        .key-display {
            background: rgba(0, 0, 0, 0.4);
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border: 2px solid rgba(255, 140, 0, 0.5);
        }
        .key-text {
            font-family: 'Courier New', monospace;
            font-size: 22px;
            color: #ff8c00;
            text-align: center;
            word-break: break-all;
            font-weight: bold;
            padding: 15px;
            background: rgba(255, 140, 0, 0.1);
            border-radius: 8px;
        }
        .copy-btn {
            width: 100%;
            padding: 15px;
            margin-top: 15px;
            background: transparent;
            color: #ff8c00;
            border: 2px solid #ff8c00;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        .copy-btn:hover {
            background: rgba(255, 140, 0, 0.2);
            transform: scale(1.02);
        }
        .loading {
            text-align: center;
            padding: 40px;
        }
        .loading .spinner {
            border: 5px solid rgba(255, 140, 0, 0.2);
            border-top: 5px solid #ff8c00;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading p {
            font-size: 18px;
            color: #ff8c00;
            font-weight: bold;
        }
        .footer {
            text-align: center;
            margin-top: 35px;
            padding-top: 25px;
            border-top: 1px solid rgba(255, 140, 0, 0.2);
            color: #666;
            font-size: 14px;
        }
        .footer a {
            color: #ff8c00;
            text-decoration: none;
            transition: all 0.3s;
        }
        .footer a:hover {
            color: #ff4500;
        }
        .method-divider {
            text-align: center;
            margin: 25px 0;
            color: #888;
            font-size: 16px;
            font-weight: bold;
        }
        .progress-bar {
            background: rgba(255, 140, 0, 0.2);
            height: 8px;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }
        .progress-fill {
            background: linear-gradient(90deg, #ff8c00, #ff4500);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }
        .step-indicator {
            text-align: center;
            color: #ff8c00;
            font-weight: bold;
            margin-bottom: 20px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <h1>VacExternal</h1>
            <p>Sistema de Keys Gratuitas (4 Horas)</p>
        </div>

        <div id="step1" class="step active">
            <div class="info-box">
                <h3>üéÅ Escolha o M√©todo para Obter sua Key</h3>
                <p style="margin-bottom: 15px;">Selecione uma das op√ß√µes abaixo para gerar sua key gratuita de 4 horas:</p>
                <ul>
                    <li>Acesso completo por 4 horas</li>
                    <li>Todos os recursos desbloqueados</li>
                    <li>Sem limites durante o per√≠odo</li>
                    <li>Renov√°vel ap√≥s expira√ß√£o</li>
                </ul>
            </div>

            <div class="captcha-wrapper">
                <p class="captcha-title">üõ°Ô∏è Verifica√ß√£o humana obrigat√≥ria</p>
                <div id="captchaContainer" class="captcha-box" data-sitekey="2714a6d4-341a-4622-b80c-e014f06c761e"></div>
                <p id="captchaStatus" class="captcha-helper">Resolva o captcha para liberar sua key ap√≥s concluir os links.</p>
            </div>

            <button class="btn" onclick="startWorkinkProcess()">
                üîó Op√ß√£o 1: Work.ink (2 Links)
            </button>
            <p style="text-align: center; margin-top: 8px; color: #888; font-size: 13px;">
                Mais r√°pido ‚Ä¢ 2 p√°ginas curtas ‚Ä¢ ‚è∞ <strong>4 horas</strong> de acesso
            </p>

            <div class="method-divider">OU</div>

            <button class="btn btn-secondary" onclick="startLinkvertiseProcess()">
                üåê Op√ß√£o 2: Linkvertise (1 Link)
            </button>
            <p style="text-align: center; margin-top: 8px; color: #4a90e2; font-size: 13px;">
                Recomendado ‚Ä¢ 1 p√°gina completa ‚Ä¢ ‚è∞ <strong style="color: #4a90e2;">8 HORAS</strong> de acesso
            </p>
        </div>

        <div id="step2" class="step">
            <div class="step-indicator">üìç Passo 1 de 2</div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 50%;"></div>
            </div>
            <div class="info-box">
                <h3>üîó Complete o Primeiro Link (Work.ink)</h3>
                <p style="margin-bottom: 15px;"><strong>Instru√ß√µes:</strong></p>
                <ul>
                    <li>Clique no bot√£o abaixo</li>
                    <li>Complete a verifica√ß√£o do Work.ink</li>
                    <li>Aguarde at√© ser redirecionado automaticamente</li>
                    <li>N√ÉO feche esta p√°gina!</li>
                </ul>
            </div>
            <div class="loading">
                <p>Redirecionando para o primeiro link...</p>
            </div>
        </div>

        <div id="step3" class="step">
            <div class="step-indicator">üìç Passo 2 de 2</div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 100%;"></div>
            </div>
            <div class="info-box">
                <h3>‚úÖ √öltimo Passo! (Work.ink #2)</h3>
                <p style="margin-bottom: 15px;"><strong>Quase l√°! Falta apenas este √∫ltimo link:</strong></p>
                <ul>
                    <li>Complete este segundo link</li>
                    <li>Aguarde o redirecionamento autom√°tico</li>
                    <li>Sua key ser√° gerada em seguida!</li>
                </ul>
            </div>
            <div class="loading">
                <p>Redirecionando para o segundo link...</p>
            </div>
        </div>

        <div id="step4" class="step">
            <div class="info-box">
                <h3>üåê Complete o Link (Linkvertise)</h3>
                <p style="margin-bottom: 15px;"><strong>Instru√ß√µes:</strong></p>
                <ul>
                    <li>Clique no bot√£o abaixo</li>
                    <li>Complete a verifica√ß√£o do Linkvertise</li>
                    <li>Aguarde at√© ser redirecionado automaticamente</li>
                    <li>N√ÉO feche esta p√°gina!</li>
                </ul>
            </div>
            <div class="loading">
                <p>Redirecionando para Linkvertise...</p>
            </div>
        </div>

        <div id="step5" class="step">
            <div class="loading">
                <div class="spinner"></div>
                <p>
                    Criando licen√ßa no KeyAuth... Aguarde alguns segundos
                </p>
            </div>
        </div>

        <div id="step6" class="step">
            <div class="info-box">
                <h3>‚úÖ Key Gerada com Sucesso!</h3>
                <p>Copie a key abaixo e cole no programa VacExternal (Op√ß√£o 4)</p>
            </div>

            <div class="key-display">
                <div class="key-text" id="generatedKey">Gerando...</div>
                <button class="copy-btn" onclick="copyKey()">üìã Copiar Key</button>
            </div>

            <div class="info-box">
                <h3>üìù Como usar:</h3>
                <ul>
                    <li>Abra o VacExternal.exe</li>
                    <li>Selecione a op√ß√£o <strong>[4] Free Version</strong></li>
                    <li>Cole a key quando solicitado</li>
                    <li>Aproveite seu acesso!</li>
                </ul>
            </div>

            <p id="keyDurationMessage" style="text-align: center; margin-top: 25px; color: #ff8c00; font-weight: bold; font-size: 16px;">
                ‚è∞ Dura√ß√£o da key ser√° exibida aqui
            </p>
            
            <script>
                const usedMethod = sessionStorage.getItem('key_method');
                const durationMsg = document.getElementById('keyDurationMessage');
                if (usedMethod === 'linkvertise') {
                    durationMsg.textContent = '‚è∞ V√°lida por 8 HORAS a partir da ativa√ß√£o';
                    durationMsg.style.color = '#4a90e2';
                } else {
                    durationMsg.textContent = '‚è∞ V√°lida por 4 horas a partir da ativa√ß√£o';
                    durationMsg.style.color = '#ff8c00';
                }
            </script>
        </div>

        <div class="footer">
            <p><strong>VacExternal</strong> ¬© 2025 - Todos os direitos reservados</p>
            <p style="margin-top: 10px;">
                Suporte e atualiza√ß√µes: 
                <a href="https://discord.gg/vacexternal" target="_blank">discord.gg/vacexternal</a>
            </p>
        </div>
    </div>

    <script>
        const WORKER_URL = "https://vacexternal-keys.outlier872.workers.dev";
        const WORKINK_LINK_1 = "https://work.ink/28kn/vacexternal-4h-key";
        const WORKINK_LINK_2 = "https://work.ink/28kn/vacexternal-get-key";
        const LINKVERTISE_LINK = "https://link-center.net/1209215/Z30kIRzDxVHY";
        const captchaStatusElement = document.getElementById('captchaStatus');
        let captchaWidgetId = null;
        let captchaToken = null;
        let captchaResolvers = [];
        let captchaReady = false;

        function updateCaptchaStatus(message, color = '#cfcfcf') {
            if (captchaStatusElement) {
                captchaStatusElement.textContent = message;
                captchaStatusElement.style.color = color;
            }
        }

        function flushCaptchaResolvers(token) {
            captchaResolvers.forEach(resolve => resolve(token));
            captchaResolvers = [];
        }

        function demandCaptchaToken(forceRefresh = false) {
            if (!captchaReady || !window.hcaptcha) {
                alert('Captcha indispon√≠vel. Configure o site key do hCaptcha e recarregue a p√°gina.');
                throw new Error('Captcha indispon√≠vel');
            }

            if (forceRefresh && window.hcaptcha && captchaWidgetId !== null) {
                window.hcaptcha.reset(captchaWidgetId);
                captchaToken = null;
            }

            if (captchaToken) {
                return Promise.resolve(captchaToken);
            }

            return new Promise(resolve => {
                captchaResolvers.push(resolve);
                updateCaptchaStatus('Resolva o captcha para liberar a key gratuita.', '#ff8c00');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        }

        function invalidateCaptchaToken() {
            captchaToken = null;
            if (window.hcaptcha && captchaWidgetId !== null) {
                window.hcaptcha.reset(captchaWidgetId);
            }
            updateCaptchaStatus('Resolva o captcha novamente para gerar outra key.');
        }
        function onCaptchaSuccess(token) {
            captchaToken = token;
            updateCaptchaStatus('‚úÖ Captcha validado. Assim que retornar dos links, aguardaremos esta valida√ß√£o.', '#00ffaa');
            flushCaptchaResolvers(token);
        }

        function onCaptchaError() {
            captchaToken = null;
            updateCaptchaStatus('Captcha falhou. Recarregue e tente novamente.', '#ff6666');
        }

        function onCaptchaExpired() {
            captchaToken = null;
            updateCaptchaStatus('Captcha expirou. Resolva novamente antes de gerar a key.', '#ff8c00');
        }

        window.onHCaptchaLoad = function() {
            const container = document.getElementById('captchaContainer');
            if (!container) {
                return;
            }

            const siteKey = container.dataset.sitekey || '';
            if (!siteKey || siteKey.includes('REPLACE')) {
                updateCaptchaStatus('Defina o site key do hCaptcha no HTML antes de publicar o site.', '#ff6666');
                return;
            }

            captchaWidgetId = hcaptcha.render('captchaContainer', {
                sitekey: siteKey,
                callback: onCaptchaSuccess,
                'error-callback': onCaptchaError,
                'expired-callback': onCaptchaExpired
            });

            captchaReady = true;
            updateCaptchaStatus('Resolva o captcha quando voltar dos links para finalizar sua key.');
        };

        function generateToken() {
            return 'tok_' + Date.now() + '_' + Math.random().toString(36).substring(2, 15);
        }

        function startWorkinkProcess() {
            const token = generateToken();
            sessionStorage.setItem('workink_token', token);
            sessionStorage.setItem('workink_timestamp', Date.now().toString());
            sessionStorage.setItem('key_method', 'workink');
            sessionStorage.setItem('workink_step', '1');
            
            console.log('üé´ Token gerado (Workink):', token.substring(0, 20) + '...');
            
            showStep(2);
            setTimeout(() => {
                window.location.href = WORKINK_LINK_1 + '?redirect=' + encodeURIComponent(window.location.origin + window.location.pathname + '?completed=step1');
            }, 2000);
        }

        function startLinkvertiseProcess() {
            const token = generateToken();
            sessionStorage.setItem('workink_token', token);
            sessionStorage.setItem('workink_timestamp', Date.now().toString());
            sessionStorage.setItem('key_method', 'linkvertise');
            
            console.log('üé´ Token gerado (Linkvertise):', token.substring(0, 20) + '...');
            
            showStep(4);
            setTimeout(() => {
                window.location.href = LINKVERTISE_LINK;
            }, 2000);
        }

        async function generateKey() {
            try {
                const token = sessionStorage.getItem('workink_token');
                const timestamp = sessionStorage.getItem('workink_timestamp');
                const method = sessionStorage.getItem('key_method');
                const linkvertiseHash = sessionStorage.getItem('linkvertise_hash');
                
                if (!token) {
                    alert('‚ùå Token expirou ou n√£o foi gerado corretamente.\n\nReinicie o processo.');
                    showStep(1);
                    return null;
                }
                
                if (timestamp && (Date.now() - parseInt(timestamp, 10)) > 1200000) {
                    alert('‚è∞ O processo demorou muito tempo.\n\nComece novamente.');
                    sessionStorage.clear();
                    showStep(1);
                    return null;
                }

                const captchaProof = await demandCaptchaToken(true);
                const requestBody = {
                    token: token,
                    method: method,
                    captchaToken: captchaProof
                };
                
                if (linkvertiseHash) {
                    requestBody.linkvertiseHash = linkvertiseHash;
                }
                
                const response = await fetch(WORKER_URL + '/generate-key', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();
                
                if (data.success) {
                    sessionStorage.clear();
                    return data.key;
                }

                if (response.status === 429) {
                    alert('‚è∞ Voc√™ j√° gerou uma key recentemente!\n\n' + data.error);
                } else if (response.status === 403) {
                    alert('üö´ ' + data.error + '\n\nComplete o processo novamente.');
                } else {
                    alert('‚ùå Erro: ' + data.error);
                }
                return null;
            } catch (error) {
                alert('‚ùå Erro ao conectar com o servidor!\n\nDetalhes: ' + error.message);
                return null;
            } finally {
                invalidateCaptchaToken();
            }
        }

        window.addEventListener('load', async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const completed = urlParams.get('completed');
            const linkvertiseHash = urlParams.get('hash');
            
            console.log('üåê P√°gina carregada!');
            console.log('üîç Completed:', completed);
            console.log('üîç Linkvertise Hash:', linkvertiseHash ? linkvertiseHash.substring(0, 20) + '...' : 'Nenhum');
            
            if (completed === 'step1') {
                const method = sessionStorage.getItem('key_method');
                if (method === 'workink') {
                    console.log('‚úÖ Step 1 completo, indo para Step 2...');
                    sessionStorage.setItem('workink_step', '2');
                    showStep(3);
                    setTimeout(() => {
                        window.location.href = WORKINK_LINK_2 + '?redirect=' + encodeURIComponent(window.location.origin + window.location.pathname + '?completed=step2');
                    }, 2000);
                }
            } else if (completed === 'step2') {
                const hasToken = sessionStorage.getItem('workink_token');
                
                if (!hasToken) {
                    console.error('‚ùå Token n√£o encontrado!');
                    alert('‚ùå Erro: Token n√£o encontrado!\n\nTente novamente em uma janela normal do navegador.');
                    showStep(1);
                    return;
                }
                
                console.log('‚úÖ Workink completo! Gerando key de 4 horas...');
                showStep(5);
                
                const key = await generateKey();
                
                if (key) {
                    console.log('üéâ Key de 4h gerada com sucesso!');
                    document.getElementById('generatedKey').textContent = key;
                    showStep(6);
                } else {
                    console.error('‚ùå Falha ao gerar key!');
                    showStep(1);
                }
            } else if (linkvertiseHash) {
                const hasToken = sessionStorage.getItem('workink_token');
                
                if (!hasToken) {
                    console.error('‚ùå Token n√£o encontrado!');
                    alert('‚ùå Erro: Token n√£o encontrado!\n\nTente novamente.');
                    showStep(1);
                    return;
                }
                
                console.log('‚úÖ Linkvertise completo! Hash recebido, gerando key de 8 horas...');
                sessionStorage.setItem('linkvertise_hash', linkvertiseHash);
                showStep(5);
                
                const key = await generateKey();
                
                if (key) {
                    console.log('üéâ Key de 8h gerada com sucesso!');
                    document.getElementById('generatedKey').textContent = key;
                    showStep(6);
                } else {
                    console.error('‚ùå Falha ao gerar key!');
                    showStep(1);
                }
            } else {
                console.log('‚ÑπÔ∏è Usu√°rio na p√°gina inicial');
                sessionStorage.clear();
            }
        });

        function copyKey() {
            const keyText = document.getElementById('generatedKey').textContent;
            navigator.clipboard.writeText(keyText).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ Copiado!';
                btn.style.background = 'linear-gradient(135deg, #00ff00, #00aa00)';
                btn.style.color = '#fff';
                btn.style.borderColor = '#00ff00';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                    btn.style.color = '';
                    btn.style.borderColor = '';
                }, 2500);
            }).catch(() => {
                alert('Erro ao copiar. Selecione e copie manualmente: ' + keyText);
            });
        }

        function showStep(stepNumber) {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById('step' + stepNumber).classList.add('active');
        }
    </script>
    <script src="https://js.hcaptcha.com/1/api.js?render=explicit&onload=onHCaptchaLoad" async defer></script>
</body>
</html>
